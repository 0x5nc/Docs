<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Uploading files to a Razor Page in ASP.NET Core </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Uploading files to a Razor Page in ASP.NET Core ">
    <meta name="generator" content="docfx 2.24.0.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="/foo">
    <meta property="docfx:tocrel" content="../../toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="tutorials/razor-pages/uploading-files">
<h1 id="uploading-files-to-a-razor-page-in-aspnet-core" sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="14" sourceendlinenumber="14">Uploading files to a Razor Page in ASP.NET Core</h1>

<p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="16" sourceendlinenumber="16">By <a href="https://github.com/guardrex" data-raw-source="[Luke Latham](https://github.com/guardrex)" sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="16" sourceendlinenumber="16">Luke Latham</a></p>
<p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="18" sourceendlinenumber="18">In this section, uploading files with a Razor Page is demonstrated.</p>
<p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="20" sourceendlinenumber="20">The <a href="https://github.com/aspnet/Docs/tree/master/aspnetcore/tutorials/razor-pages/razor-pages-start/sample/RazorPagesMovie" data-raw-source="[Razor Pages Movie sample app](https://github.com/aspnet/Docs/tree/master/aspnetcore/tutorials/razor-pages/razor-pages-start/sample/RazorPagesMovie)" sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="20" sourceendlinenumber="20">Razor Pages Movie sample app</a> in this tutorial uses simple model binding to upload files, which works well for uploading small files. For information on streaming large files, see <a class="xref" href="../../mvc/models/file-uploads.html#uploading-large-files-with-streaming" data-raw-source="[Uploading large files with streaming](xref:mvc/models/file-uploads#uploading-large-files-with-streaming)" sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="20" sourceendlinenumber="20">Uploading large files with streaming</a>.</p>
<p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="22" sourceendlinenumber="22">In the steps below, you add a movie schedule file upload feature to the sample app. A movie schedule is represented by a <code>Schedule</code> class. The class includes two versions of the schedule. One version is provided to customers, <code>PublicSchedule</code>. The other version is used for company employees, <code>PrivateSchedule</code>. Each version is uploaded as a separate file. The tutorial demonstrates how to perform two file uploads from a page with a single POST to the server.</p>
<h2 id="add-a-helper-method-to-upload-files" sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="24" sourceendlinenumber="24">Add a helper method to upload files</h2>
<p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="26" sourceendlinenumber="26">To avoid code duplication for processing uploaded schedule files, add a static helper method first. Create a <em>Utilities</em> folder in the app and add a <em>FileHelpers.cs</em> file with the following content. The helper method, <code>ProcessFormFile</code>, takes an <a href="/dotnet/api/microsoft.aspnetcore.http.iformfile" data-raw-source="[IFormFile](/dotnet/api/microsoft.aspnetcore.http.iformfile)" sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="26" sourceendlinenumber="26">IFormFile</a> and <a href="/api/microsoft.aspnetcore.mvc.modelbinding.modelstatedictionary" data-raw-source="[ModelStateDictionary](/api/microsoft.aspnetcore.mvc.modelbinding.modelstatedictionary)" sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="26" sourceendlinenumber="26">ModelStateDictionary</a> and returns a string containing the file&#39;s size and content. The content type and length are checked. If the file doesn&#39;t pass a validation check, an error is added to the <code>ModelState</code>.</p>
<pre sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="28" sourceendlinenumber="28"><code class="lang-csharp" name="Main">using System.ComponentModel.DataAnnotations;
using System.IO;
using System.Net;
using System.Reflection;
using System.Text;
using System.Threading.Tasks;
using Microsoft.AspNetCore.Http;
using Microsoft.AspNetCore.Mvc.ModelBinding;
using RazorPagesMovie.Models;

namespace RazorPagesMovie.Utilities
{
    public class FileHelpers
    {
        public static async Task&lt;string&gt; ProcessFormFile(IFormFile formFile, ModelStateDictionary modelState)
        {
            var fieldDisplayName = string.Empty;

            // Use reflection to obtain the display name for the model 
            // property associated with this IFormFile. If a display
            // name isn&#39;t found, error messages simply won&#39;t show
            // a display name.
            MemberInfo property = typeof(FileUpload).GetProperty(formFile.Name.Substring(formFile.Name.IndexOf(&quot;.&quot;) + 1));

            if (property != null)
            {
                var displayAttribute = property.GetCustomAttribute(typeof(DisplayAttribute)) as DisplayAttribute;

                if (displayAttribute != null)
                {
                    fieldDisplayName = $&quot;{displayAttribute.Name} &quot;;
                }
            }

            // Use Path.GetFileName to obtain the file name, which will
            // strip any path information passed as part of the
            // FileName property. HtmlEncode the result in case it must 
            // be returned in an error message.
            var fileName = WebUtility.HtmlEncode(Path.GetFileName(formFile.FileName));

            if (formFile.ContentType.ToLower() != &quot;text/plain&quot;)
            {
                modelState.AddModelError(formFile.Name, $&quot;The {fieldDisplayName}file ({fileName}) must be a text file.&quot;);
            }

            // Check the file length and don&#39;t bother attempting to
            // read it if the file contains no content. This check
            // doesn&#39;t catch files that only have a BOM as their
            // content, so a content length check is made later after 
            // reading the file&#39;s content to catch a file that only
            // contains a BOM.
            if (formFile.Length == 0)
            {
                modelState.AddModelError(formFile.Name, $&quot;The {fieldDisplayName}file ({fileName}) is empty.&quot;);
            }
            else
            {
                try
                {
                    string fileContents;

                    using (var reader = new StreamReader(formFile.OpenReadStream(), new UTF8Encoding(encoderShouldEmitUTF8Identifier: false, throwOnInvalidBytes: true), detectEncodingFromByteOrderMarks: true))
                    {
                        fileContents = await reader.ReadToEndAsync();

                        // Check the content length in case the file&#39;s only
                        // content was a BOM and the content is actually
                        // empty after removing the BOM.
                        if (fileContents.Length &gt; 0)
                        {
                            return fileContents;
                        }
                        else
                        {
                            modelState.AddModelError(formFile.Name, $&quot;The {fieldDisplayName}file ({fileName}) is empty.&quot;);
                        }
                    }
                }
                catch (IOException ex)
                {
                    modelState.AddModelError(formFile.Name, $&quot;The {fieldDisplayName}file ({fileName}) upload failed. Please contact the Help Desk for support.&quot;);
                    // Log the exception
                }
            }

            return string.Empty;
        }
    }
}
</code></pre><h2 id="add-the-schedule-class" sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="30" sourceendlinenumber="30">Add the Schedule class</h2>
<p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="32" sourceendlinenumber="32">Right click the <em>Models</em> folder. Select <strong>Add</strong> &gt; <strong>Class</strong>. Name the class <strong>Schedule</strong> and add the following properties:</p>
<pre sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="34" sourceendlinenumber="34"><code class="lang-csharp" name="Main">using System;
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;

namespace RazorPagesMovie.Models
{
    public class Schedule
    {
        public int ID { get; set; }
        public string Title { get; set; }

        public string PublicSchedule { get; set; }

        [Display(Name=&quot;Public Schedule Size (bytes)&quot;)]
        [DisplayFormat(DataFormatString = &quot;{0:N1}&quot;)]
        public long PublicScheduleSize { get; set; }

        public string PrivateSchedule { get; set; }

        [Display(Name=&quot;Private Schedule Size (bytes)&quot;)]
        [DisplayFormat(DataFormatString = &quot;{0:N1}&quot;)]
        public long PrivateScheduleSize { get; set; }

        [Display(Name=&quot;Uploaded (UTC)&quot;)]
        [DisplayFormat(DataFormatString = &quot;{0:F}&quot;)]
        public DateTime UploadDT { get; set;}
    }
}
</code></pre><p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="36" sourceendlinenumber="36">The class uses <code>Display</code> and <code>DisplayFormat</code> attributes, which produce friendly titles and formatting when the schedule data is rendered.</p>
<h2 id="update-the-moviecontext" sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="38" sourceendlinenumber="38">Update the MovieContext</h2>
<p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="40" sourceendlinenumber="40">Specify a <code>DbSet</code> in the <code>MovieContext</code> (<em>Models/MovieContext.cs</em>) for the schedules and add a line to the <code>OnModelCreating</code> method that sets a singular database table name (<code>Schedule</code>) for the <code>DbSet</code> property:</p>
<pre sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="42" sourceendlinenumber="42"><code class="lang-csharp" name="Main" highlight-lines="13,18">using Microsoft.EntityFrameworkCore;

namespace RazorPagesMovie.Models
{
    public class MovieContext : DbContext
    {
        public MovieContext(DbContextOptions&lt;MovieContext&gt; options)
            : base(options)
        {
        }

        public DbSet&lt;Movie&gt; Movies { get; set; }
        public DbSet&lt;Schedule&gt; Schedules { get; set; }

        protected override void OnModelCreating(ModelBuilder modelBuilder)
        {
            modelBuilder.Entity&lt;Movie&gt;().ToTable(&quot;Movie&quot;);
            modelBuilder.Entity&lt;Schedule&gt;().ToTable(&quot;Schedule&quot;);
        }
    }
}
</code></pre><p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="44" sourceendlinenumber="44">Note: If you don&#39;t override <code>OnModelCreating</code> to use singular table names, Entity Framework assumes that you&#39;re using plural database table names (for example, <code>Movies</code> and <code>Schedules</code>). Developers disagree about whether table names should be pluralized or not. Configure the <code>MovieContext</code> and the database the same way. Either use singular or pluralized database table names in both places.</p>
<h2 id="add-the-schedule-table-to-the-database" sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="46" sourceendlinenumber="46">Add the Schedule table to the database</h2>
<p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="48" sourceendlinenumber="48">Open the Package Manger Console (PMC): <strong>Tools</strong> &gt; <strong>NuGet Package Manager</strong> &gt; <strong>Package Manager Console</strong>.</p>
<p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="50" sourceendlinenumber="50"><img src="../first-mvc-app/adding-model/_static/pmc.png" alt="PMC menu" sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="50" sourceendlinenumber="50"></p>
<p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="52" sourceendlinenumber="52">In the PMC, execute the following commands. These commands add a <code>Schedule</code> table to the database:</p>
<pre sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="54" sourceendlinenumber="57"><code class="lang-powershell">Add-Migration AddScheduleTable
Update-Database
</code></pre><h2 id="add-a-fileupload-class" sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="59" sourceendlinenumber="59">Add a FileUpload class</h2>
<p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="61" sourceendlinenumber="61">Next, add a <code>FileUpload</code> class, which is bound to the page to obtain the schedule data. Right click the <em>Models</em> folder. Select <strong>Add</strong> &gt; <strong>Class</strong>. Name the class <strong>FileUpload</strong> and add the following properties:</p>
<pre sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="63" sourceendlinenumber="63"><code class="lang-csharp" name="Main">using Microsoft.AspNetCore.Http;
using System.ComponentModel.DataAnnotations;

namespace RazorPagesMovie.Models
{
    public class FileUpload
    {
        [Required]
        [Display(Name=&quot;Title&quot;)]
        [StringLength(60, MinimumLength = 3)]
        public string Title { get; set; }

        [Required]
        [Display(Name=&quot;Public Schedule&quot;)]
        public IFormFile UploadPublicSchedule { get; set; }

        [Required]
        [Display(Name=&quot;Private Schedule&quot;)]
        public IFormFile UploadPrivateSchedule { get; set; }
    }
}
</code></pre><p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="65" sourceendlinenumber="65">The class has a property for the schedule&#39;s title and a property for each of the two versions of the schedule. All three properties are required, and the title must be 3-60 characters long.</p>
<h2 id="add-a-file-upload-razor-page" sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="67" sourceendlinenumber="67">Add a file upload Razor Page</h2>
<p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="69" sourceendlinenumber="69">In the <em>Pages</em> folder, create a <em>Schedules</em> folder. In the <em>Schedules</em> folder, create a page named <em>Index.cshtml</em> for uploading a schedule with the following content:</p>
<pre sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="71" sourceendlinenumber="71"><code class="lang-cshtml" name="Main">@page
@model RazorPagesMovie.Pages.Schedules.IndexModel

@{
    ViewData[&quot;Title&quot;] = &quot;Schedules&quot;;
}

&lt;h2&gt;Schedules&lt;/h2&gt;
&lt;hr /&gt;

&lt;h3&gt;Upload Schedules&lt;/h3&gt;
&lt;div class=&quot;row&quot;&gt;
    &lt;div class=&quot;col-md-4&quot;&gt;
        &lt;form method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;
            &lt;div class=&quot;form-group&quot;&gt;
                &lt;label asp-for=&quot;FileUpload.Title&quot; class=&quot;control-label&quot;&gt;&lt;/label&gt;
                &lt;input asp-for=&quot;FileUpload.Title&quot; type=&quot;text&quot; class=&quot;form-control&quot; /&gt;
                &lt;span asp-validation-for=&quot;FileUpload.Title&quot; class=&quot;text-danger&quot;&gt;&lt;/span&gt;
            &lt;/div&gt;
            &lt;div class=&quot;form-group&quot;&gt;
                &lt;label asp-for=&quot;FileUpload.UploadPublicSchedule&quot; class=&quot;control-label&quot;&gt;&lt;/label&gt;
                &lt;input asp-for=&quot;FileUpload.UploadPublicSchedule&quot; type=&quot;file&quot; class=&quot;form-control&quot; style=&quot;height:auto&quot; /&gt;
                &lt;span asp-validation-for=&quot;FileUpload.UploadPublicSchedule&quot; class=&quot;text-danger&quot;&gt;&lt;/span&gt;
            &lt;/div&gt;
            &lt;div class=&quot;form-group&quot;&gt;
                &lt;label asp-for=&quot;FileUpload.UploadPrivateSchedule&quot; class=&quot;control-label&quot;&gt;&lt;/label&gt;
                &lt;input asp-for=&quot;FileUpload.UploadPrivateSchedule&quot; type=&quot;file&quot; class=&quot;form-control&quot; style=&quot;height:auto&quot; /&gt;
                &lt;span asp-validation-for=&quot;FileUpload.UploadPrivateSchedule&quot; class=&quot;text-danger&quot;&gt;&lt;/span&gt;
            &lt;/div&gt;
            &lt;input type=&quot;submit&quot; value=&quot;Upload&quot; class=&quot;btn btn-default&quot; /&gt;
        &lt;/form&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;h3&gt;Loaded Schedules&lt;/h3&gt;
&lt;table class=&quot;table&quot;&gt;
    &lt;thead&gt;
        &lt;tr&gt;
            &lt;th&gt;&lt;/th&gt;
            &lt;th&gt;
                @Html.DisplayNameFor(model =&gt; model.Schedules[0].Title)
            &lt;/th&gt;
            &lt;th&gt;
                @Html.DisplayNameFor(model =&gt; model.Schedules[0].UploadDT)
            &lt;/th&gt;
            &lt;th class=&quot;text-center&quot;&gt;
                @Html.DisplayNameFor(model =&gt; model.Schedules[0].PublicScheduleSize)
            &lt;/th&gt;
            &lt;th class=&quot;text-center&quot;&gt;
                @Html.DisplayNameFor(model =&gt; model.Schedules[0].PrivateScheduleSize)
            &lt;/th&gt;
        &lt;/tr&gt;
    &lt;/thead&gt;
    &lt;tbody&gt;
    @foreach (var item in Model.Schedules) {
        &lt;tr&gt;
            &lt;td&gt;
                &lt;a asp-page=&quot;./Delete&quot; asp-route-id=&quot;@item.ID&quot;&gt;Delete&lt;/a&gt;
            &lt;/td&gt;
            &lt;td&gt;
                @Html.DisplayFor(modelItem =&gt; item.Title)
            &lt;/td&gt;
            &lt;td&gt;
                @Html.DisplayFor(modelItem =&gt; item.UploadDT)
            &lt;/td&gt;
            &lt;td class=&quot;text-center&quot;&gt;
                @Html.DisplayFor(modelItem =&gt; item.PublicScheduleSize)
            &lt;/td&gt;
            &lt;td class=&quot;text-center&quot;&gt;
                @Html.DisplayFor(modelItem =&gt; item.PrivateScheduleSize)
            &lt;/td&gt;
        &lt;/tr&gt;
    }
    &lt;/tbody&gt;
&lt;/table&gt;

@section Scripts {
    @{await Html.RenderPartialAsync(&quot;_ValidationScriptsPartial&quot;);}
}
</code></pre><p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="73" sourceendlinenumber="73">Each form group includes a <strong>&lt;label&gt;</strong> that displays the name of each class property. The <code>Display</code> attributes in the <code>FileUpload</code> model provide the display values for the labels. For example, the <code>UploadPublicSchedule</code> property&#39;s display name is set with <code>[Display(Name=&quot;Public Schedule&quot;)]</code> and thus displays &quot;Public Schedule&quot; in the label when the form renders.</p>
<p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="75" sourceendlinenumber="75">Each form group includes a validation <strong>&lt;span&gt;</strong>. If the user&#39;s input fails to meet the property attributes set in the <code>FileUpload</code> class or if any of the <code>ProcessFormFile</code> method file validation checks fail, the model fails to validate. When model validation fails, a helpful validation message is rendered to the user. For example, the <code>Title</code> property is annotated with <code>[Required]</code> and <code>[StringLength(60, MinimumLength = 3)]</code>. If the user fails to supply a title, they receive a message indicating that a value is required. If the user enters a value less than three characters or more than sixty characters, they receive a message indicating that the value has an incorrect length. If a file is provided that has no content, a message appears indicating that the file is empty.</p>
<h2 id="add-the-code-behind-file" sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="77" sourceendlinenumber="77">Add the code-behind file</h2>
<p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="79" sourceendlinenumber="79">Add the code-behind file (<em>Index.cshtml.cs</em>) to the <em>Schedules</em> folder:</p>
<pre sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="81" sourceendlinenumber="81"><code class="lang-csharp" name="Main">using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using Microsoft.AspNetCore.Mvc;
using Microsoft.AspNetCore.Mvc.RazorPages;
using Microsoft.EntityFrameworkCore;
using RazorPagesMovie.Models;
using RazorPagesMovie.Utilities;

namespace RazorPagesMovie.Pages.Schedules
{
    public class IndexModel : PageModel
    {
        private readonly RazorPagesMovie.Models.MovieContext _context;

        public IndexModel(RazorPagesMovie.Models.MovieContext context)
        {
            _context = context;
        }

        [BindProperty]
        public FileUpload FileUpload { get; set; }

        public IList&lt;Schedule&gt; Schedules { get; private set; }

        public async Task OnGetAsync()
        {
            Schedules = await _context.Schedules.AsNoTracking().ToListAsync();
        }

        public async Task&lt;IActionResult&gt; OnPostAsync()
        {
            // Perform an initial check to catch FileUpload class
            // attribute violations.
            if (!ModelState.IsValid)
            {
                Schedules = await _context.Schedules.AsNoTracking().ToListAsync();
                return Page();
            }

            var publicScheduleData = 
                await FileHelpers.ProcessFormFile(FileUpload.UploadPublicSchedule, ModelState);

            var privateScheduleData = 
                await FileHelpers.ProcessFormFile(FileUpload.UploadPrivateSchedule, ModelState);

            // Perform a second check to catch ProcessFormFile method
            // violations.
            if (!ModelState.IsValid)
            {
                Schedules = await _context.Schedules.AsNoTracking().ToListAsync();
                return Page();
            }

            var schedule = new Schedule() 
                { 
                    PublicSchedule = publicScheduleData, 
                    PublicScheduleSize = FileUpload.UploadPublicSchedule.Length, 
                    PrivateSchedule = privateScheduleData, 
                    PrivateScheduleSize = FileUpload.UploadPrivateSchedule.Length, 
                    Title = FileUpload.Title, 
                    UploadDT = DateTime.UtcNow
                };

            _context.Schedules.Add(schedule);
            await _context.SaveChangesAsync();

            return RedirectToPage(&quot;./Index&quot;);
        }
    }
}
</code></pre><p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="83" sourceendlinenumber="83">The page model (<code>IndexModel</code> in <em>Index.cshtml.cs</em>) binds the <code>FileUpload</code> class:</p>
<pre sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="85" sourceendlinenumber="85"><code class="lang-csharp" name="Main">[BindProperty]
public FileUpload FileUpload { get; set; }
</code></pre><p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="87" sourceendlinenumber="87">The model also uses a list of the schedules (<code>IList&lt;Schedule&gt;</code>) to display the schedules stored in the database on the page:</p>
<pre sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="89" sourceendlinenumber="89"><code class="lang-csharp" name="Main">public IList&lt;Schedule&gt; Schedules { get; private set; }
</code></pre><p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="91" sourceendlinenumber="91">When the page loads with <code>OnGetAsync</code>, <code>Schedules</code> is populated from the database and used to generate an HTML table of loaded schedules:</p>
<pre sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="93" sourceendlinenumber="93"><code class="lang-csharp" name="Main">public async Task OnGetAsync()
{
    Schedules = await _context.Schedules.AsNoTracking().ToListAsync();
}
</code></pre><p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="95" sourceendlinenumber="95">When the form is posted to the server, the <code>ModelState</code> is checked. If invalid, <code>Schedules</code> is rebuilt, and the page renders with one or more validation messages stating why page validation failed. If valid, the <code>FileUpload</code> properties are used in <em>OnPostAsync</em> to complete the file upload for the two versions of the schedule and to create a new <code>Schedule</code> object to store the data. The schedule is then saved to the database:</p>
<pre sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="97" sourceendlinenumber="97"><code class="lang-csharp" name="Main">public async Task&lt;IActionResult&gt; OnPostAsync()
{
    // Perform an initial check to catch FileUpload class
    // attribute violations.
    if (!ModelState.IsValid)
    {
        Schedules = await _context.Schedules.AsNoTracking().ToListAsync();
        return Page();
    }

    var publicScheduleData = 
        await FileHelpers.ProcessSchedule(FileUpload.UploadPublicSchedule, ModelState);

    var privateScheduleData = 
        await FileHelpers.ProcessSchedule(FileUpload.UploadPrivateSchedule, ModelState);

    // Perform a second check to catch ProcessSchedule method
    // violations.
    if (!ModelState.IsValid)
    {
        Schedules = await _context.Schedules.AsNoTracking().ToListAsync();
        return Page();
    }

    var schedule = new Schedule() 
        { 
            PublicSchedule = publicScheduleData, 
            PublicScheduleSize = FileUpload.UploadPublicSchedule.Length, 
            PrivateSchedule = privateScheduleData, 
            PrivateScheduleSize = FileUpload.UploadPrivateSchedule.Length, 
            Title = FileUpload.Title, 
            UploadDT = DateTime.UtcNow
        };

    _context.Schedules.Add(schedule);
    await _context.SaveChangesAsync();

    return RedirectToPage(&quot;./Index&quot;);
}
</code></pre><h2 id="link-the-file-upload-razor-page" sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="99" sourceendlinenumber="99">Link the file upload Razor Page</h2>
<p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="101" sourceendlinenumber="101">Open <em>_Layout.cshtml</em> and add a link to the navigation bar to reach the file upload page:</p>
<pre sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="103" sourceendlinenumber="103"><code class="lang-cshtml" name="Main" highlight-lines="4">&lt;div class=&quot;navbar-collapse collapse&quot;&gt;
    &lt;ul class=&quot;nav navbar-nav&quot;&gt;
        &lt;li&gt;&lt;a asp-page=&quot;/Index&quot;&gt;Home&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a asp-page=&quot;/Schedules/Index&quot;&gt;Schedules&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a asp-page=&quot;/About&quot;&gt;About&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a asp-page=&quot;/Contact&quot;&gt;Contact&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
&lt;/div&gt;
</code></pre><h2 id="add-a-page-to-confirm-schedule-deletion" sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="105" sourceendlinenumber="105">Add a page to confirm schedule deletion</h2>
<p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="107" sourceendlinenumber="107">When the user clicks to delete a schedule, you want them to have a chance to cancel the operation. Add a delete confirmation page (<em>Delete.cshtml</em>) to the <em>Schedules</em> folder:</p>
<pre sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="109" sourceendlinenumber="109"><code class="lang-cshtml" name="Main">@page &quot;{id:int}&quot;
@model RazorPagesMovie.Pages.Schedules.DeleteModel

@{
    ViewData[&quot;Title&quot;] = &quot;Delete Schedule&quot;;
}

&lt;h2&gt;Delete Schedule&lt;/h2&gt;

&lt;h3&gt;Are you sure you want to delete this?&lt;/h3&gt;
&lt;div&gt;
    &lt;h4&gt;Schedule&lt;/h4&gt;
    &lt;hr /&gt;
    &lt;dl class=&quot;dl-horizontal&quot;&gt;
        &lt;dt&gt;
            @Html.DisplayNameFor(model =&gt; model.Schedule.Title)
        &lt;/dt&gt;
        &lt;dd&gt;
            @Html.DisplayFor(model =&gt; model.Schedule.Title)
        &lt;/dd&gt;
        &lt;dt&gt;
            @Html.DisplayNameFor(model =&gt; model.Schedule.PublicScheduleSize)
        &lt;/dt&gt;
        &lt;dd&gt;
            @Html.DisplayFor(model =&gt; model.Schedule.PublicScheduleSize)
        &lt;/dd&gt;
        &lt;dt&gt;
            @Html.DisplayNameFor(model =&gt; model.Schedule.PrivateScheduleSize)
        &lt;/dt&gt;
        &lt;dd&gt;
            @Html.DisplayFor(model =&gt; model.Schedule.PrivateScheduleSize)
        &lt;/dd&gt;
        &lt;dt&gt;
            @Html.DisplayNameFor(model =&gt; model.Schedule.UploadDT)
        &lt;/dt&gt;
        &lt;dd&gt;
            @Html.DisplayFor(model =&gt; model.Schedule.UploadDT)
        &lt;/dd&gt;
    &lt;/dl&gt;
    
    &lt;form method=&quot;post&quot;&gt;
        &lt;input type=&quot;hidden&quot; asp-for=&quot;Schedule.ID&quot; /&gt;
        &lt;input type=&quot;submit&quot; value=&quot;Delete&quot; class=&quot;btn btn-default&quot; /&gt; |
        &lt;a asp-page=&quot;./Index&quot;&gt;Back to List&lt;/a&gt;
    &lt;/form&gt;
&lt;/div&gt;
</code></pre><p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="111" sourceendlinenumber="111">The code-behind file (<em>Delete.cshtml.cs</em>) loads a single schedule identified by <code>id</code> in the request&#39;s route data. Add the <em>Delete.cshtml.cs</em> file to the <em>Schedules</em> folder:</p>
<pre sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="113" sourceendlinenumber="113"><code class="lang-csharp" name="Main">using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using Microsoft.AspNetCore.Mvc;
using Microsoft.AspNetCore.Mvc.RazorPages;
using Microsoft.EntityFrameworkCore;
using RazorPagesMovie.Models;

namespace RazorPagesMovie.Pages.Schedules
{
    public class DeleteModel : PageModel
    {
        private readonly RazorPagesMovie.Models.MovieContext _context;

        public DeleteModel(RazorPagesMovie.Models.MovieContext context)
        {
            _context = context;
        }

        [BindProperty]
        public Schedule Schedule { get; set; }

        public async Task&lt;IActionResult&gt; OnGetAsync(int? id)
        {
            if (id == null)
            {
                return NotFound();
            }

            Schedule = await _context.Schedules.SingleOrDefaultAsync(m =&gt; m.ID == id);

            if (Schedule == null)
            {
                return NotFound();
            }
            return Page();
        }

        public async Task&lt;IActionResult&gt; OnPostAsync(int? id)
        {
            if (id == null)
            {
                return NotFound();
            }

            Schedule = await _context.Schedules.FindAsync(id);

            if (Schedule != null)
            {
                _context.Schedules.Remove(Schedule);
                await _context.SaveChangesAsync();
            }

            return RedirectToPage(&quot;./Index&quot;);
        }
    }
}
</code></pre><p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="115" sourceendlinenumber="115">The <code>OnPostAsync</code> method handles deleting the schedule by its <code>id</code>:</p>
<pre sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="117" sourceendlinenumber="117"><code class="lang-csharp" name="Main" highlight-lines="8,12-13">public async Task&lt;IActionResult&gt; OnPostAsync(int? id)
{
    if (id == null)
    {
        return NotFound();
    }

    Schedule = await _context.Schedules.FindAsync(id);

    if (Schedule != null)
    {
        _context.Schedules.Remove(Schedule);
        await _context.SaveChangesAsync();
    }

    return RedirectToPage(&quot;./Index&quot;);
}
</code></pre><p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="119" sourceendlinenumber="119">After successfully deleting the schedule, the <code>RedirectToPage</code> sends the user back to the schedules <em>Index.cshtml</em> page.</p>
<h2 id="the-working-schedules-razor-page" sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="121" sourceendlinenumber="121">The working Schedules Razor Page</h2>
<p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="123" sourceendlinenumber="123">When the page loads, labels and inputs for schedule title, public schedule, and private schedule are rendered with a submit button:</p>
<p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="125" sourceendlinenumber="125"><img src="uploading-files/_static/browser1.png" alt="Schedules Razor Page as seen on initial load with no validation errors and empty fields" sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="125" sourceendlinenumber="125"></p>
<p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="127" sourceendlinenumber="127">Selecting the <strong>Upload</strong> button without populating any of the fields violates the <code>[Required]</code> attributes on the model. The <code>ModelState</code> is invalid. The validation error messages are displayed to the user:</p>
<p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="129" sourceendlinenumber="129"><img src="uploading-files/_static/browser2.png" alt="Validation error messages appear next to each input control" sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="129" sourceendlinenumber="129"></p>
<p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="131" sourceendlinenumber="131">Type two letters into the <strong>Title</strong> field. The validation message changes to indicate that the title must be between 3-60 characters:</p>
<p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="133" sourceendlinenumber="133"><img src="uploading-files/_static/browser3.png" alt="Title validation message changed" sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="133" sourceendlinenumber="133"></p>
<p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="135" sourceendlinenumber="135">When one or more schedules are uploaded, the <strong>Loaded Schedules</strong> section renders the loaded schedules:</p>
<p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="137" sourceendlinenumber="137"><img src="uploading-files/_static/browser4.png" alt="Table of loaded schedules, showing each schedule&#39;s title, uploaded date in UTC, public version file size, and private version file size" sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="137" sourceendlinenumber="137"></p>
<p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="139" sourceendlinenumber="139">The user can click the <strong>Delete</strong> link from there to reach the delete confirmation view, where they have an opportunity to confirm or cancel the delete operation.</p>
<h2 id="troubleshooting" sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="141" sourceendlinenumber="141">Troubleshooting</h2>
<p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="143" sourceendlinenumber="143">For troubleshooting information with <code>IFormFile</code> uploading, see the <a class="xref" href="../../mvc/models/file-uploads.html#troubleshooting" data-raw-source="[File uploads in ASP.NET Core: Troubleshooting](xref:mvc/models/file-uploads#troubleshooting)" sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="143" sourceendlinenumber="143">File uploads in ASP.NET Core: Troubleshooting</a>.</p>
<p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="145" sourceendlinenumber="145">Thanks for completing this introduction to Razor Pages. We appreciate any comments you leave. <a class="xref" href="../../data/ef-mvc/intro.html" data-raw-source="[Getting started with MVC and EF Core](xref:data/ef-mvc/intro)" sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="145" sourceendlinenumber="145">Getting started with MVC and EF Core</a> is an excellent follow up to this tutorial.</p>
<h2 id="additional-resources" sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="147" sourceendlinenumber="147">Additional resources</h2>
<ul sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="149" sourceendlinenumber="150">
<li sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="149" sourceendlinenumber="149"><a class="xref" href="../../mvc/models/file-uploads.html" data-raw-source="[File uploads in ASP.NET Core](xref:mvc/models/file-uploads)" sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="149" sourceendlinenumber="149">File uploads in ASP.NET Core</a></li>
<li sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="150" sourceendlinenumber="150"><a href="/dotnet/api/microsoft.aspnetcore.http.iformfile" data-raw-source="[IFormFile](/dotnet/api/microsoft.aspnetcore.http.iformfile)" sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="150" sourceendlinenumber="150">IFormFile</a></li>
</ul>
<div class="step-by-step" sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="152" sourceendlinenumber="152"><p sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="153" sourceendlinenumber="153"><a class="xref" href="validation.html" data-raw-source="[Previous: Validation](xref:tutorials/razor-pages/validation)" sourcefile="tutorials/razor-pages/uploading-files.md" sourcestartlinenumber="153" sourceendlinenumber="153">Previous: Validation</a></p>
</div>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/aspnet/Docs/blob/w/riande/RP-EF/aspnetcore/tutorials/razor-pages/uploading-files.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Copyright © 2015-2017 Microsoft<br>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
