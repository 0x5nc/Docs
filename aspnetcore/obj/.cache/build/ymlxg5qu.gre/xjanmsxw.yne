<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Introduction to Identity on ASP.NET Core </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Introduction to Identity on ASP.NET Core ">
    <meta name="generator" content="docfx 2.24.0.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="/foo">
    <meta property="docfx:tocrel" content="../../toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="security/authentication/identity">
<h1 id="introduction-to-identity-on-aspnet-core" sourcefile="security/authentication/identity.md" sourcestartlinenumber="15" sourceendlinenumber="15">Introduction to Identity on ASP.NET Core</h1>

<p sourcefile="security/authentication/identity.md" sourcestartlinenumber="17" sourceendlinenumber="17">By <a href="https://github.com/rustd" data-raw-source="[Pranav Rastogi](https://github.com/rustd)" sourcefile="security/authentication/identity.md" sourcestartlinenumber="17" sourceendlinenumber="17">Pranav Rastogi</a>, <a href="https://twitter.com/RickAndMSFT" data-raw-source="[Rick Anderson](https://twitter.com/RickAndMSFT)" sourcefile="security/authentication/identity.md" sourcestartlinenumber="17" sourceendlinenumber="17">Rick Anderson</a>, <a href="https://github.com/tdykstra" data-raw-source="[Tom Dykstra](https://github.com/tdykstra)" sourcefile="security/authentication/identity.md" sourcestartlinenumber="17" sourceendlinenumber="17">Tom Dykstra</a>, Jon Galloway, <a href="https://github.com/Erikre" data-raw-source="[Erik Reitan](https://github.com/Erikre)" sourcefile="security/authentication/identity.md" sourcestartlinenumber="17" sourceendlinenumber="17">Erik Reitan</a>, and <a href="https://ardalis.com/" data-raw-source="[Steve Smith](https://ardalis.com/)" sourcefile="security/authentication/identity.md" sourcestartlinenumber="17" sourceendlinenumber="17">Steve Smith</a></p>
<p sourcefile="security/authentication/identity.md" sourcestartlinenumber="19" sourceendlinenumber="19">ASP.NET Core Identity is a membership system which allows you to add login functionality to your application. Users can create an account and login with a user name and password or they can use an external login provider such as Facebook, Google, Microsoft Account, Twitter or others.</p>
<p sourcefile="security/authentication/identity.md" sourcestartlinenumber="21" sourceendlinenumber="21">You can configure ASP.NET Core Identity to use a SQL Server database to store user names, passwords, and profile data. Alternatively, you can use your own persistent store, for example Azure Table Storage. This document contains instructions for Visual Studio and for using the CLI.</p>
<h2 id="overview-of-identity" sourcefile="security/authentication/identity.md" sourcestartlinenumber="23" sourceendlinenumber="23">Overview of Identity</h2>
<p sourcefile="security/authentication/identity.md" sourcestartlinenumber="25" sourceendlinenumber="25">In this topic, you&#39;ll learn how to use ASP.NET Core Identity to add functionality to register, log in, and log out a user. For more detailed instructions about creating apps using ASP.NET Core Identity, see the Next Steps section at the end of this article.</p>
<ol sourcefile="security/authentication/identity.md" sourcestartlinenumber="27" sourceendlinenumber="136">
<li sourcefile="security/authentication/identity.md" sourcestartlinenumber="27" sourceendlinenumber="41"><p sourcefile="security/authentication/identity.md" sourcestartlinenumber="27" sourceendlinenumber="27">Create an ASP.NET Core Web Application project with Individual User Accounts.</p>
<div class="tabGroup" id="tabgroup_yS0QDAFpXJ" sourcefile="security/authentication/identity.md" sourcestartlinenumber="29" sourceendlinenumber="36">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_yS0QDAFpXJ_visual-studio" role="tab" aria-controls="tabpanel_yS0QDAFpXJ_visual-studio" data-tab="visual-studio" tabindex="0" aria-selected="true" sourcefile="security/authentication/identity.md" sourcestartlinenumber="29" sourceendlinenumber="29">Visual Studio</a>
</li>
<li role="presentation">
<a href="#tabpanel_yS0QDAFpXJ_netcore-cli" role="tab" aria-controls="tabpanel_yS0QDAFpXJ_netcore-cli" data-tab="netcore-cli" tabindex="-1" sourcefile="security/authentication/identity.md" sourcestartlinenumber="36" sourceendlinenumber="36">.NET Core CLI</a>
</li>
</ul>
<section id="tabpanel_yS0QDAFpXJ_visual-studio" role="tabpanel" data-tab="visual-studio">
<p sourcefile="security/authentication/identity.md" sourcestartlinenumber="30" sourceendlinenumber="30">In Visual Studio, select <strong>File</strong> -&gt; <strong>New</strong> -&gt; <strong>Project</strong>. Select the <strong>ASP.NET Web Application</strong> from the <strong>New Project</strong> dialog box. Selecting an ASP.NET Core <strong>Web Application</strong> with <strong>Individual User Accounts</strong> as the authentication method.</p>
<p sourcefile="security/authentication/identity.md" sourcestartlinenumber="32" sourceendlinenumber="32">Note: You must select <strong>Individual User Accounts</strong>.</p>
<p sourcefile="security/authentication/identity.md" sourcestartlinenumber="34" sourceendlinenumber="34"><img src="identity/_static/01-mvc.png" alt="New Project dialog" sourcefile="security/authentication/identity.md" sourcestartlinenumber="34" sourceendlinenumber="34"></p>
</section>
<section id="tabpanel_yS0QDAFpXJ_netcore-cli" role="tabpanel" data-tab="netcore-cli" aria-hidden="true" hidden="hidden">
<p sourcefile="security/authentication/identity.md" sourcestartlinenumber="37" sourceendlinenumber="37">If using the .NET Core CLI, create the new project using <code>dotnet new mvc --auth Individual</code>. This will create a new project with the same Identity template code Visual Studio creates.</p>
<p sourcefile="security/authentication/identity.md" sourcestartlinenumber="39" sourceendlinenumber="39">The created project contains the <code>Microsoft.AspNetCore.Identity.EntityFrameworkCore</code> package, which will persist the Identity data and schema to SQL Server using <a href="https://docs.microsoft.com/ef/" data-raw-source="[Entity Framework Core](https://docs.microsoft.com/ef/)" sourcefile="security/authentication/identity.md" sourcestartlinenumber="39" sourceendlinenumber="39">Entity Framework Core</a>.</p>
</section>
</div>
</li>
<li sourcefile="security/authentication/identity.md" sourcestartlinenumber="43" sourceendlinenumber="69"><p sourcefile="security/authentication/identity.md" sourcestartlinenumber="43" sourceendlinenumber="43">Configure Identity services and add middleware in <code>Startup</code>.</p>
<p sourcefile="security/authentication/identity.md" sourcestartlinenumber="45" sourceendlinenumber="45">The Identity services are added to the application in the <code>ConfigureServices</code> method in the <code>Startup</code> class:</p>
<div class="tabGroup" id="tabgroup_yS0QDAFpXJ-1" sourcefile="security/authentication/identity.md" sourcestartlinenumber="47" sourceendlinenumber="63">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_yS0QDAFpXJ-1_aspnetcore2x" role="tab" aria-controls="tabpanel_yS0QDAFpXJ-1_aspnetcore2x" data-tab="aspnetcore2x" tabindex="0" aria-selected="true" sourcefile="security/authentication/identity.md" sourcestartlinenumber="47" sourceendlinenumber="47">ASP.NET Core 2.x</a>
</li>
<li role="presentation">
<a href="#tabpanel_yS0QDAFpXJ-1_aspnetcore1x" role="tab" aria-controls="tabpanel_yS0QDAFpXJ-1_aspnetcore1x" data-tab="aspnetcore1x" tabindex="-1" sourcefile="security/authentication/identity.md" sourcestartlinenumber="57" sourceendlinenumber="57">ASP.NET Core 1.x</a>
</li>
</ul>
<section id="tabpanel_yS0QDAFpXJ-1_aspnetcore2x" role="tabpanel" data-tab="aspnetcore2x">
<pre sourcefile="security/authentication/identity.md" sourcestartlinenumber="49" sourceendlinenumber="49"><code class="lang-csharp" name="Main" highlight-lines="7-9,11-28,30-39">// This method gets called by the runtime. Use this method to add services to the container.
public void ConfigureServices(IServiceCollection services)
{
    services.AddDbContext&lt;ApplicationDbContext&gt;(options =&gt;
        options.UseSqlServer(Configuration.GetConnectionString(&quot;DefaultConnection&quot;)));

    services.AddIdentity&lt;ApplicationUser, IdentityRole&gt;()
        .AddEntityFrameworkStores&lt;ApplicationDbContext&gt;()
        .AddDefaultTokenProviders();

    services.Configure&lt;IdentityOptions&gt;(options =&gt;
    {
        // Password settings
        options.Password.RequireDigit = true;
        options.Password.RequiredLength = 8;
        options.Password.RequireNonAlphanumeric = false;
        options.Password.RequireUppercase = true;
        options.Password.RequireLowercase = false;
        options.Password.RequiredUniqueChars = 6;

        // Lockout settings
        options.Lockout.DefaultLockoutTimeSpan = TimeSpan.FromMinutes(30);
        options.Lockout.MaxFailedAccessAttempts = 10;
        options.Lockout.AllowedForNewUsers = true;

        // User settings
        options.User.RequireUniqueEmail = true;
    });

    services.ConfigureApplicationCookie(options =&gt;
    {
        // Cookie settings
        options.Cookie.HttpOnly = true;
        options.Cookie.Expiration = TimeSpan.FromDays(150);
        options.LoginPath = &quot;/Account/Login&quot;; // If the LoginPath is not set here, ASP.NET Core will default to /Account/Login
        options.LogoutPath = &quot;/Account/Logout&quot;; // If the LogoutPath is not set here, ASP.NET Core will default to /Account/Logout
        options.AccessDeniedPath = &quot;/Account/AccessDenied&quot;; // If the AccessDeniedPath is not set here, ASP.NET Core will default to /Account/AccessDenied
        options.SlidingExpiration = true;
    });

    // Add application services.
    services.AddTransient&lt;IEmailSender, EmailSender&gt;();

    services.AddMvc();
}
</code></pre><p sourcefile="security/authentication/identity.md" sourcestartlinenumber="51" sourceendlinenumber="51">These services are made available to the application through <a class="xref" href="../../fundamentals/dependency-injection.html" data-raw-source="[dependency injection](xref:fundamentals/dependency-injection)" sourcefile="security/authentication/identity.md" sourcestartlinenumber="51" sourceendlinenumber="51">dependency injection</a>.</p>
<p sourcefile="security/authentication/identity.md" sourcestartlinenumber="53" sourceendlinenumber="53">Identity is enabled for the application by calling <code>UseAuthentication</code> in the <code>Configure</code> method. <code>UseAuthentication</code> adds authentication <a class="xref" href="../../fundamentals/middleware.html" data-raw-source="[middleware](xref:fundamentals/middleware)" sourcefile="security/authentication/identity.md" sourcestartlinenumber="53" sourceendlinenumber="53">middleware</a> to the request pipeline.</p>
<pre sourcefile="security/authentication/identity.md" sourcestartlinenumber="55" sourceendlinenumber="55"><code class="lang-csharp" name="Main" highlight-lines="17">// This method gets called by the runtime. Use this method to configure the HTTP request pipeline.
public void Configure(IApplicationBuilder app, IHostingEnvironment env)
{
    if (env.IsDevelopment())
    {
        app.UseDeveloperExceptionPage();
        app.UseBrowserLink();
        app.UseDatabaseErrorPage();
    }
    else
    {
        app.UseExceptionHandler(&quot;/Home/Error&quot;);
    }

    app.UseStaticFiles();

    app.UseAuthentication();

    app.UseMvc(routes =&gt;
    {
        routes.MapRoute(
            name: &quot;default&quot;,
            template: &quot;{controller=Home}/{action=Index}/{id?}&quot;);
    });
}
</code></pre></section>
<section id="tabpanel_yS0QDAFpXJ-1_aspnetcore1x" role="tabpanel" data-tab="aspnetcore1x" aria-hidden="true" hidden="hidden">
<pre sourcefile="security/authentication/identity.md" sourcestartlinenumber="59" sourceendlinenumber="59"><code class="lang-csharp" name="Main" highlight-lines="7-9,13-34">public void ConfigureServices(IServiceCollection services)
{
    // Add framework services.
    services.AddDbContext&lt;ApplicationDbContext&gt;(options =&gt;
        options.UseSqlServer(Configuration.GetConnectionString(&quot;DefaultConnection&quot;)));

    services.AddIdentity&lt;ApplicationUser, IdentityRole&gt;()
        .AddEntityFrameworkStores&lt;ApplicationDbContext&gt;()
        .AddDefaultTokenProviders();

    services.AddMvc();

    // Configure Identity
    services.Configure&lt;IdentityOptions&gt;(options =&gt;
    {
        // Password settings
        options.Password.RequireDigit = true;
        options.Password.RequiredLength = 8;
        options.Password.RequireNonAlphanumeric = false;
        options.Password.RequireUppercase = true;
        options.Password.RequireLowercase = false;

        // Lockout settings
        options.Lockout.DefaultLockoutTimeSpan = TimeSpan.FromMinutes(30);
        options.Lockout.MaxFailedAccessAttempts = 10;

        // Cookie settings
        options.Cookies.ApplicationCookie.ExpireTimeSpan = TimeSpan.FromDays(150);
        options.Cookies.ApplicationCookie.LoginPath = &quot;/Account/LogIn&quot;;
        options.Cookies.ApplicationCookie.LogoutPath = &quot;/Account/LogOut&quot;;

        // User settings
        options.User.RequireUniqueEmail = true;
    });

    // Add application services.
    services.AddTransient&lt;IEmailSender, AuthMessageSender&gt;();
    services.AddTransient&lt;ISmsSender, AuthMessageSender&gt;();
}
</code></pre><p sourcefile="security/authentication/identity.md" sourcestartlinenumber="61" sourceendlinenumber="61">These services are made available to the application through <a class="xref" href="../../fundamentals/dependency-injection.html" data-raw-source="[dependency injection](xref:fundamentals/dependency-injection)" sourcefile="security/authentication/identity.md" sourcestartlinenumber="61" sourceendlinenumber="61">dependency injection</a>.</p>
<p sourcefile="security/authentication/identity.md" sourcestartlinenumber="63" sourceendlinenumber="63">Identity is enabled for the application by calling <code>UseIdentity</code> in the <code>Configure</code> method. <code>UseIdentity</code> adds cookie-based authentication <a class="xref" href="../../fundamentals/middleware.html" data-raw-source="[middleware](xref:fundamentals/middleware)" sourcefile="security/authentication/identity.md" sourcestartlinenumber="63" sourceendlinenumber="63">middleware</a> to the request pipeline.</p>
<pre sourcefile="security/authentication/identity.md" sourcestartlinenumber="65" sourceendlinenumber="65"><code class="lang-csharp" name="Main" highlight-lines="21">public void Configure(IApplicationBuilder app,
    IHostingEnvironment env, 
    ILoggerFactory loggerFactory)
{
    loggerFactory.AddConsole(Configuration.GetSection(&quot;Logging&quot;));
    loggerFactory.AddDebug();

    if (env.IsDevelopment())
    {
        app.UseDeveloperExceptionPage();
        app.UseDatabaseErrorPage();
        app.UseBrowserLink();
    }
    else
    {
        app.UseExceptionHandler(&quot;/Home/Error&quot;);
    }

    app.UseStaticFiles();

    app.UseIdentity();

    // Add external authentication middleware below. To configure them please see https://go.microsoft.com/fwlink/?LinkID=532715

    app.UseMvc(routes =&gt;
    {
        routes.MapRoute(
            name: &quot;default&quot;,
            template: &quot;{controller=Home}/{action=Index}/{id?}&quot;);
    });
}
</code></pre></section>
</div>
<p sourcefile="security/authentication/identity.md" sourcestartlinenumber="69" sourceendlinenumber="69">For more information about the application start up process, see <a class="xref" href="../../fundamentals/startup.html" data-raw-source="[Application Startup](xref:fundamentals/startup)" sourcefile="security/authentication/identity.md" sourcestartlinenumber="69" sourceendlinenumber="69">Application Startup</a>.</p>
</li>
<li sourcefile="security/authentication/identity.md" sourcestartlinenumber="71" sourceendlinenumber="92"><p sourcefile="security/authentication/identity.md" sourcestartlinenumber="71" sourceendlinenumber="71">Create a user.</p>
<p sourcefile="security/authentication/identity.md" sourcestartlinenumber="73" sourceendlinenumber="73">Launch the application and then click on the <strong>Register</strong> link.</p>
<p sourcefile="security/authentication/identity.md" sourcestartlinenumber="75" sourceendlinenumber="75">If this is the first time you&#39;re performing this action, you may be required to run migrations. The application prompts you to <strong>Apply Migrations</strong>:</p>
<p sourcefile="security/authentication/identity.md" sourcestartlinenumber="77" sourceendlinenumber="77"><img src="identity/_static/apply-migrations.png" alt="Apply Migrations Web Page" sourcefile="security/authentication/identity.md" sourcestartlinenumber="77" sourceendlinenumber="77"></p>
<p sourcefile="security/authentication/identity.md" sourcestartlinenumber="79" sourceendlinenumber="79">Alternately, you can test using ASP.NET Core Identity with your app without a persistent database by using an in-memory database. To use an in-memory database, add the <code>Microsoft.EntityFrameworkCore.InMemory</code> package to your app and modify your app&#39;s call to <code>AddDbContext</code> in <code>ConfigureServices</code> as follows:</p>
<pre sourcefile="security/authentication/identity.md" sourcestartlinenumber="81" sourceendlinenumber="84"><code class="lang-csharp">services.AddDbContext&lt;ApplicationDbContext&gt;(options =&gt;
    options.UseInMemoryDatabase(Guid.NewGuid().ToString()));
</code></pre><p sourcefile="security/authentication/identity.md" sourcestartlinenumber="86" sourceendlinenumber="86">When the user clicks the <strong>Register</strong> link, the <code>Register</code> action is invoked on <code>AccountController</code>. The <code>Register</code> action creates the user by calling <code>CreateAsync</code> on the  <code>_userManager</code> object (provided to <code>AccountController</code> by dependency injection):</p>
<pre sourcefile="security/authentication/identity.md" sourcestartlinenumber="88" sourceendlinenumber="88"><code class="lang-csharp" name="Main" highlight-lines="11">//
// POST: /Account/Register
[HttpPost]
[AllowAnonymous]
[ValidateAntiForgeryToken]
public async Task&lt;IActionResult&gt; Register(RegisterViewModel model)
{
    if (ModelState.IsValid)
    {
        var user = new ApplicationUser { UserName = model.Email, Email = model.Email };
        var result = await _userManager.CreateAsync(user, model.Password);
        if (result.Succeeded)
        {
            // For more information on how to enable account confirmation and password reset please visit http://go.microsoft.com/fwlink/?LinkID=532713
            // Send an email with this link
            //var code = await _userManager.GenerateEmailConfirmationTokenAsync(user);
            //var callbackUrl = Url.Action(&quot;ConfirmEmail&quot;, &quot;Account&quot;, new { userId = user.Id, code = code }, protocol: HttpContext.Request.Scheme);
            //await _emailSender.SendEmailAsync(model.Email, &quot;Confirm your account&quot;,
            //    &quot;Please confirm your account by clicking this link: &lt;a href=\&quot;&quot; + callbackUrl + &quot;\&quot;&gt;link&lt;/a&gt;&quot;);
            await _signInManager.SignInAsync(user, isPersistent: false);
            _logger.LogInformation(3, &quot;User created a new account with password.&quot;);
            return RedirectToAction(nameof(HomeController.Index), &quot;Home&quot;);
        }
        AddErrors(result);
    }

    // If we got this far, something failed, redisplay form
    return View(model);
}
</code></pre><p sourcefile="security/authentication/identity.md" sourcestartlinenumber="90" sourceendlinenumber="90">If the user was created successfully, the user is logged in by the call to <code>_signInManager.SignInAsync</code>.</p>
<p sourcefile="security/authentication/identity.md" sourcestartlinenumber="92" sourceendlinenumber="92"><strong>Note:</strong> See <a class="xref" href="accconfirm.html#prevent-login-at-registration" data-raw-source="[account confirmation](xref:security/authentication/accconfirm#prevent-login-at-registration)" sourcefile="security/authentication/identity.md" sourcestartlinenumber="92" sourceendlinenumber="92">account confirmation</a> for steps to prevent immediate login at registration.</p>
</li>
<li sourcefile="security/authentication/identity.md" sourcestartlinenumber="94" sourceendlinenumber="102"><p sourcefile="security/authentication/identity.md" sourcestartlinenumber="94" sourceendlinenumber="94">Log in.</p>
<p sourcefile="security/authentication/identity.md" sourcestartlinenumber="96" sourceendlinenumber="96">Users can sign in by clicking the <strong>Log in</strong> link at the top of the site, or they may be navigated to the Login page if they attempt to access a part of the site that requires authorization. When the user submits the form on the Login page, the <code>AccountController</code> <code>Login</code> action is called.</p>
<pre sourcefile="security/authentication/identity.md" sourcestartlinenumber="98" sourceendlinenumber="98"><code class="lang-csharp" name="Main" highlight-lines="13-14">//
// POST: /Account/Login
[HttpPost]
[AllowAnonymous]
[ValidateAntiForgeryToken]
public async Task&lt;IActionResult&gt; Login(LoginViewModel model, string returnUrl = null)
{
    ViewData[&quot;ReturnUrl&quot;] = returnUrl;
    if (ModelState.IsValid)
    {
        // This doesn&#39;t count login failures towards account lockout
        // To enable password failures to trigger account lockout, set lockoutOnFailure: true
        var result = await _signInManager.PasswordSignInAsync(model.Email, 
            model.Password, model.RememberMe, lockoutOnFailure: false);
        if (result.Succeeded)
        {
            _logger.LogInformation(1, &quot;User logged in.&quot;);
            return RedirectToLocal(returnUrl);
        }
        if (result.RequiresTwoFactor)
        {
            return RedirectToAction(nameof(SendCode), new { ReturnUrl = returnUrl, RememberMe = model.RememberMe });
        }
        if (result.IsLockedOut)
        {
            _logger.LogWarning(2, &quot;User account locked out.&quot;);
            return View(&quot;Lockout&quot;);
        }
        else
        {
            ModelState.AddModelError(string.Empty, &quot;Invalid login attempt.&quot;);
            return View(model);
        }
    }

    // If we got this far, something failed, redisplay form
    return View(model);
}
</code></pre><p sourcefile="security/authentication/identity.md" sourcestartlinenumber="100" sourceendlinenumber="100">The <code>Login</code> action calls <code>PasswordSignInAsync</code> on the <code>_signInManager</code> object (provided to <code>AccountController</code> by dependency injection).</p>
<p sourcefile="security/authentication/identity.md" sourcestartlinenumber="102" sourceendlinenumber="102">The base <code>Controller</code> class exposes a <code>User</code> property that you can access from controller methods. For instance, you can enumerate <code>User.Claims</code> and make authorization decisions. For more information, see <a class="xref" href="../authorization/index.html" data-raw-source="[Authorization](xref:security/authorization/index)" sourcefile="security/authentication/identity.md" sourcestartlinenumber="102" sourceendlinenumber="102">Authorization</a>.</p>
</li>
<li sourcefile="security/authentication/identity.md" sourcestartlinenumber="104" sourceendlinenumber="110"><p sourcefile="security/authentication/identity.md" sourcestartlinenumber="104" sourceendlinenumber="104">Log out.</p>
<p sourcefile="security/authentication/identity.md" sourcestartlinenumber="106" sourceendlinenumber="106">Clicking the <strong>Log out</strong> link calls the <code>LogOut</code> action.</p>
<pre sourcefile="security/authentication/identity.md" sourcestartlinenumber="108" sourceendlinenumber="108"><code class="lang-csharp" name="Main" highlight-lines="7">//
// POST: /Account/LogOut
[HttpPost]
[ValidateAntiForgeryToken]
public async Task&lt;IActionResult&gt; LogOut()
{
    await _signInManager.SignOutAsync();
    _logger.LogInformation(4, &quot;User logged out.&quot;);
    return RedirectToAction(nameof(HomeController.Index), &quot;Home&quot;);
}
</code></pre><p sourcefile="security/authentication/identity.md" sourcestartlinenumber="110" sourceendlinenumber="110">The preceding code above calls the <code>_signInManager.SignOutAsync</code> method. The <code>SignOutAsync</code> method clears the user&#39;s claims stored in a cookie.</p>
</li>
<li sourcefile="security/authentication/identity.md" sourcestartlinenumber="112" sourceendlinenumber="128"><p sourcefile="security/authentication/identity.md" sourcestartlinenumber="112" sourceendlinenumber="112">Configuration.</p>
<p sourcefile="security/authentication/identity.md" sourcestartlinenumber="114" sourceendlinenumber="114">Identity has some default behaviors that you can override in your application&#39;s startup class. You do not need to configure <code>IdentityOptions</code> if you are using the default behaviors.</p>
<div class="tabGroup" id="tabgroup_yS0QDAFpXJ-2" sourcefile="security/authentication/identity.md" sourcestartlinenumber="116" sourceendlinenumber="124">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_yS0QDAFpXJ-2_aspnetcore2x" role="tab" aria-controls="tabpanel_yS0QDAFpXJ-2_aspnetcore2x" data-tab="aspnetcore2x" tabindex="0" aria-selected="true" sourcefile="security/authentication/identity.md" sourcestartlinenumber="116" sourceendlinenumber="116">ASP.NET Core 2.x</a>
</li>
<li role="presentation">
<a href="#tabpanel_yS0QDAFpXJ-2_aspnetcore1x" role="tab" aria-controls="tabpanel_yS0QDAFpXJ-2_aspnetcore1x" data-tab="aspnetcore1x" tabindex="-1" sourcefile="security/authentication/identity.md" sourcestartlinenumber="120" sourceendlinenumber="120">ASP.NET Core 1.x</a>
</li>
</ul>
<section id="tabpanel_yS0QDAFpXJ-2_aspnetcore2x" role="tabpanel" data-tab="aspnetcore2x">
<pre sourcefile="security/authentication/identity.md" sourcestartlinenumber="118" sourceendlinenumber="118"><code class="lang-csharp" name="Main" highlight-lines="7-9,11-28,30-39">// This method gets called by the runtime. Use this method to add services to the container.
public void ConfigureServices(IServiceCollection services)
{
    services.AddDbContext&lt;ApplicationDbContext&gt;(options =&gt;
        options.UseSqlServer(Configuration.GetConnectionString(&quot;DefaultConnection&quot;)));

    services.AddIdentity&lt;ApplicationUser, IdentityRole&gt;()
        .AddEntityFrameworkStores&lt;ApplicationDbContext&gt;()
        .AddDefaultTokenProviders();

    services.Configure&lt;IdentityOptions&gt;(options =&gt;
    {
        // Password settings
        options.Password.RequireDigit = true;
        options.Password.RequiredLength = 8;
        options.Password.RequireNonAlphanumeric = false;
        options.Password.RequireUppercase = true;
        options.Password.RequireLowercase = false;
        options.Password.RequiredUniqueChars = 6;

        // Lockout settings
        options.Lockout.DefaultLockoutTimeSpan = TimeSpan.FromMinutes(30);
        options.Lockout.MaxFailedAccessAttempts = 10;
        options.Lockout.AllowedForNewUsers = true;

        // User settings
        options.User.RequireUniqueEmail = true;
    });

    services.ConfigureApplicationCookie(options =&gt;
    {
        // Cookie settings
        options.Cookie.HttpOnly = true;
        options.Cookie.Expiration = TimeSpan.FromDays(150);
        options.LoginPath = &quot;/Account/Login&quot;; // If the LoginPath is not set here, ASP.NET Core will default to /Account/Login
        options.LogoutPath = &quot;/Account/Logout&quot;; // If the LogoutPath is not set here, ASP.NET Core will default to /Account/Logout
        options.AccessDeniedPath = &quot;/Account/AccessDenied&quot;; // If the AccessDeniedPath is not set here, ASP.NET Core will default to /Account/AccessDenied
        options.SlidingExpiration = true;
    });

    // Add application services.
    services.AddTransient&lt;IEmailSender, EmailSender&gt;();

    services.AddMvc();
}
</code></pre></section>
<section id="tabpanel_yS0QDAFpXJ-2_aspnetcore1x" role="tabpanel" data-tab="aspnetcore1x" aria-hidden="true" hidden="hidden">
<pre sourcefile="security/authentication/identity.md" sourcestartlinenumber="122" sourceendlinenumber="122"><code class="lang-csharp" name="Main" highlight-lines="13-34">public void ConfigureServices(IServiceCollection services)
{
    // Add framework services.
    services.AddDbContext&lt;ApplicationDbContext&gt;(options =&gt;
        options.UseSqlServer(Configuration.GetConnectionString(&quot;DefaultConnection&quot;)));

    services.AddIdentity&lt;ApplicationUser, IdentityRole&gt;()
        .AddEntityFrameworkStores&lt;ApplicationDbContext&gt;()
        .AddDefaultTokenProviders();

    services.AddMvc();

    // Configure Identity
    services.Configure&lt;IdentityOptions&gt;(options =&gt;
    {
        // Password settings
        options.Password.RequireDigit = true;
        options.Password.RequiredLength = 8;
        options.Password.RequireNonAlphanumeric = false;
        options.Password.RequireUppercase = true;
        options.Password.RequireLowercase = false;

        // Lockout settings
        options.Lockout.DefaultLockoutTimeSpan = TimeSpan.FromMinutes(30);
        options.Lockout.MaxFailedAccessAttempts = 10;

        // Cookie settings
        options.Cookies.ApplicationCookie.ExpireTimeSpan = TimeSpan.FromDays(150);
        options.Cookies.ApplicationCookie.LoginPath = &quot;/Account/LogIn&quot;;
        options.Cookies.ApplicationCookie.LogoutPath = &quot;/Account/LogOut&quot;;

        // User settings
        options.User.RequireUniqueEmail = true;
    });

    // Add application services.
    services.AddTransient&lt;IEmailSender, AuthMessageSender&gt;();
    services.AddTransient&lt;ISmsSender, AuthMessageSender&gt;();
}
</code></pre></section>
</div>
<p sourcefile="security/authentication/identity.md" sourcestartlinenumber="126" sourceendlinenumber="126">For more information about how to configure Identity, see <a class="xref" href="identity-configuration.html" data-raw-source="[Configure Identity](xref:security/authentication/identity-configuration)" sourcefile="security/authentication/identity.md" sourcestartlinenumber="126" sourceendlinenumber="126">Configure Identity</a>.</p>
<p sourcefile="security/authentication/identity.md" sourcestartlinenumber="128" sourceendlinenumber="128">You also can configure the data type of the primary key, see <a class="xref" href="identity-primary-key-configuration.html" data-raw-source="[Configure Identity primary keys data type](xref:security/authentication/identity-primary-key-configuration)" sourcefile="security/authentication/identity.md" sourcestartlinenumber="128" sourceendlinenumber="128">Configure Identity primary keys data type</a>.</p>
</li>
<li sourcefile="security/authentication/identity.md" sourcestartlinenumber="130" sourceendlinenumber="136"><p sourcefile="security/authentication/identity.md" sourcestartlinenumber="130" sourceendlinenumber="130">View the database.</p>
<p sourcefile="security/authentication/identity.md" sourcestartlinenumber="132" sourceendlinenumber="132">If your app is using a SQL Server database (the default on Windows and for Visual Studio users), you can view the database the app created. You can use <strong>SQL Server Management Studio</strong>. Alternatively, from Visual Studio, select <strong>View</strong> -&gt; <strong>SQL Server Object Explorer</strong>. Connect to <strong>(localdb)\MSSQLLocalDB</strong>. The database with a name matching <strong>aspnet-&lt;<em>name of your project</em>&gt;-&lt;<em>date string</em>&gt;</strong> is displayed.</p>
<p sourcefile="security/authentication/identity.md" sourcestartlinenumber="134" sourceendlinenumber="134"><img src="identity/_static/04-db.png" alt="Contextual menu on AspNetUsers database table" sourcefile="security/authentication/identity.md" sourcestartlinenumber="134" sourceendlinenumber="134"></p>
<p sourcefile="security/authentication/identity.md" sourcestartlinenumber="136" sourceendlinenumber="136">Expand the database and its <strong>Tables</strong>, then right-click the <strong>dbo.AspNetUsers</strong> table and select <strong>View Data</strong>.</p>
</li>
</ol>
<h2 id="identity-components" sourcefile="security/authentication/identity.md" sourcestartlinenumber="138" sourceendlinenumber="138">Identity Components</h2>
<p sourcefile="security/authentication/identity.md" sourcestartlinenumber="140" sourceendlinenumber="140">The primary reference assembly for the Identity system is <code>Microsoft.AspNetCore.Identity</code>. This package contains the core set of interfaces for ASP.NET Core Identity, and is included by <code>Microsoft.AspNetCore.Identity.EntityFrameworkCore</code>.</p>
<p sourcefile="security/authentication/identity.md" sourcestartlinenumber="142" sourceendlinenumber="142">These dependencies are needed to use the Identity system in ASP.NET Core applications:</p>
<ul sourcefile="security/authentication/identity.md" sourcestartlinenumber="144" sourceendlinenumber="148">
<li sourcefile="security/authentication/identity.md" sourcestartlinenumber="144" sourceendlinenumber="144"><p sourcefile="security/authentication/identity.md" sourcestartlinenumber="144" sourceendlinenumber="144"><code>Microsoft.AspNetCore.Identity.EntityFrameworkCore</code> - Contains the required types to use Identity with Entity Framework Core.</p>
</li>
<li sourcefile="security/authentication/identity.md" sourcestartlinenumber="146" sourceendlinenumber="146"><p sourcefile="security/authentication/identity.md" sourcestartlinenumber="146" sourceendlinenumber="146"><code>Microsoft.EntityFrameworkCore.SqlServer</code> - Entity Framework Core is Microsoft&#39;s recommended data access technology for relational databases like SQL Server. For testing, you can use <code>Microsoft.EntityFrameworkCore.InMemory</code>.</p>
</li>
<li sourcefile="security/authentication/identity.md" sourcestartlinenumber="148" sourceendlinenumber="148"><p sourcefile="security/authentication/identity.md" sourcestartlinenumber="148" sourceendlinenumber="148"><code>Microsoft.AspNetCore.Authentication.Cookies</code> - Middleware that enables an app to use cookie-based authentication.</p>
</li>
</ul>
<h2 id="migrating-to-aspnet-core-identity" sourcefile="security/authentication/identity.md" sourcestartlinenumber="150" sourceendlinenumber="150">Migrating to ASP.NET Core Identity</h2>
<p sourcefile="security/authentication/identity.md" sourcestartlinenumber="152" sourceendlinenumber="152">For additional information and guidance on migrating your existing Identity store see <a class="xref" href="../../migration/identity.html" data-raw-source="[Migrating Authentication and Identity](xref:migration/identity)" sourcefile="security/authentication/identity.md" sourcestartlinenumber="152" sourceendlinenumber="152">Migrating Authentication and Identity</a>.</p>
<h2 id="next-steps" sourcefile="security/authentication/identity.md" sourcestartlinenumber="154" sourceendlinenumber="154">Next Steps</h2>
<ul sourcefile="security/authentication/identity.md" sourcestartlinenumber="156" sourceendlinenumber="159">
<li sourcefile="security/authentication/identity.md" sourcestartlinenumber="156" sourceendlinenumber="156"><a class="xref" href="../../migration/identity.html" data-raw-source="[Migrating Authentication and Identity](xref:migration/identity)" sourcefile="security/authentication/identity.md" sourcestartlinenumber="156" sourceendlinenumber="156">Migrating Authentication and Identity</a></li>
<li sourcefile="security/authentication/identity.md" sourcestartlinenumber="157" sourceendlinenumber="157"><a class="xref" href="accconfirm.html" data-raw-source="[Account Confirmation and Password Recovery](xref:security/authentication/accconfirm)" sourcefile="security/authentication/identity.md" sourcestartlinenumber="157" sourceendlinenumber="157">Account Confirmation and Password Recovery</a></li>
<li sourcefile="security/authentication/identity.md" sourcestartlinenumber="158" sourceendlinenumber="158"><a class="xref" href="2fa.html" data-raw-source="[Two-factor authentication with SMS](xref:security/authentication/2fa)" sourcefile="security/authentication/identity.md" sourcestartlinenumber="158" sourceendlinenumber="158">Two-factor authentication with SMS</a></li>
<li sourcefile="security/authentication/identity.md" sourcestartlinenumber="159" sourceendlinenumber="159"><a class="xref" href="social/index.html" data-raw-source="[Enabling authentication using Facebook, Google and other external providers](xref:security/authentication/social/index)" sourcefile="security/authentication/identity.md" sourcestartlinenumber="159" sourceendlinenumber="159">Enabling authentication using Facebook, Google and other external providers</a></li>
</ul>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/aspnet/Docs/blob/w/riande/RP-EF/aspnetcore/security/authentication/identity.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Copyright © 2015-2017 Microsoft<br>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
